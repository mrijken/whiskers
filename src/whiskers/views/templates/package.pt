<!DOCTYPE html5>
<html xml:lang="en" xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal">

  <head metal:use-macro="main.macros['head']" />

<tal:block metal:use-macro="main.macros['body']">
  <div metal:fill-slot="content">
    <div class="container">
      <h2 class="title">
        ${package_name}
      </h2>

      <div tal:condition="package" class="package-details">
        <h3 tal:condition="package.version">
          ${package.version.version}
        </h3>

        <div tal:condition="not: package.buildouts">
          <p>This package is not used by any buildouts anymore or yet.</p>
        </div>

        <a class="all-versions" tal:condition="other_versions"
           href="${request.route_url('packages')}/${package_name}">
           (all versions)
        </a>

        <div class="used_by" tal:condition="package.buildouts">
          <h5>This package is used by following buildouts:</h5>
          <p tal:condition="not:'all_buildouts' in request.params">
            Note: Only the newest buildouts are shown. <a class="btn btn-small btn-primary" href="?all_buildouts"> Show all versions of the buildouts</a>
          </p>
          <p tal:condition="'all_buildouts' in request.params">
            Note: All versions of the buildouts are shown. <a class="btn btn-small btn-primary" href="?">Show only the newest buildouts</a>
          </p>
          <ul>
            <li tal:repeat="buildout [b for b in package.buildouts if (('all_buildouts' in request.params) or b.isNewest())]">
              <a href="${request.route_url('buildouts')}/${buildout.id}">
                ${buildout.name} - ${buildout.datetime.strftime("%Y-%m-%d %H:%M:%S")}
              </a>
            </li>
          </ul>
        </div>

        <div class="requires" tal:condition="package.requires">
          <h5>This package requires following packages:</h5>
          <ul>
            <li tal:repeat="requires package.requires">
              <a href="${request.route_url('packages')}/${requires.name}/${requires.id}">
                <tal:block tal:content="string: ${requires.name}" />
                <tal:block tal:condition="requires.version" tal:content="string: - ${requires.version.version}" />
              </a>
            </li>
          </ul>
        </div>

        <div class="required_by" tal:condition="package.required_by">
          <h5>This package is required by following packages:</h5>
          <ul>
            <li tal:repeat="requires package.required_by">
              <a href="${request.route_url('packages')}/${requires.name}/${requires.id}"
                 tal:content="string: ${requires.name} - ${requires.version.version}" />
            </li>
          </ul>
        </div>
      </div>

      <tal:packages tal:condition="not: package" tal:repeat="result packages">
           <h3>
            <a class="all-versions" tal:condition="other_versions"
            href="${request.route_url('packages')}/${package_name}/${result.id}">
           ${result.version.version}
            </a>
          </h3>

       <div tal:condition="result.buildouts" class="package-details">
          <p>This package is used by following buildouts:</p>
          <p tal:condition="not:'all_buildouts' in request.params">
            Note: Only the newest buildouts are shown. <a class="btn btn-small btn-primary" href="?all_buildouts"> Show all versions of the buildouts</a>
          </p>
          <p tal:condition="'all_buildouts' in request.params">
            Note: All versions of the buildouts are shown. <a class="btn btn-small btn-primary" href="?">Show only the newest buildouts</a>
          </p>
          <ul>
            <li tal:repeat="buildout [b for b in result.buildouts if ('all_buildouts' in request.params or b.isNewest())]">
              <a href="${request.route_url('buildouts')}/${buildout.id}">
                ${buildout.name} - ${buildout.datetime.strftime("%Y-%m-%d %H:%M:%S")}
              </a>
            </li>
          </ul>
        </div>
        <div tal:condition="not: result.buildouts">
          <p>This package is not used by any buildouts anymore or yet.</p>
        </div>
      </tal:packages>
    </div>
  </div>
</tal:block>
</html>
